<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flights</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <link rel="stylesheet" href="../css/style.css" />

    <style>
      .banner-wrapper {
        position: relative;
      }

      .hero-caption {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: white;
        z-index: 10;
      }

      .flight-banner {
        width: 100%;
        height: 350px;
        object-fit: cover;
        border-radius: 30px;
        filter: brightness(50%);
      }

      .hero-caption h1 {
        font-size: 60px;
        font-weight: bold;
      }

      .hero-caption p {
        font-size: 28px;
      }

      @media (max-width: 992px) {
        .flight-banner {
          height: 260px;
        }
        .hero-caption h1 {
          font-size: 40px;
        }
        .hero-caption p {
          font-size: 20px;
        }
      }

      @media (max-width: 576px) {
        .flight-banner {
          height: 200px;
        }
        .hero-caption h1 {
          font-size: 26px;
        }
        .hero-caption p {
          font-size: 14px;
        }
      }

      form select,
      form input {
        border-radius: 10px;
      }

      .btn-primary,
      .btn-primary:hover {
        background-color: #193764;
        border: none;
        border-radius: 12px;
      }

      .btn-outline-secondary {
        border-radius: 50%;
      }

      .btn-success,
      .btn-success:hover {
        background-color: #193764;
        border-color: #193764;
      }

      .flight-card {
        border-radius: 16px;
        border: 1px solid #e6e6e6;
        transition: all 0.2s ease;
      }

      .flight-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      }

      .airline-badge {
        background-color: #193764;
        color: #fff;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 14px;
      }

      .flight-meta {
        font-size: 14px;
        color: #555;
      }

      .price-tag {
        font-size: 20px;
        font-weight: 700;
        color: #193764;
      }

      .details-toggle {
        cursor: pointer;
        color: #193764;
        font-size: 14px;
      }

      .details-box {
        display: none;
        border-top: 1px dashed #ddd;
        margin-top: 12px;
        padding-top: 12px;
        font-size: 14px;
      }

      .flight-results-wrapper {
        max-width: 780px;
        margin: 0 auto;
      }
    </style>
  </head>

  <body style="background-color: #f7f7f7">
    <div class="page-wrapper">
      <nav class="navbar navbar-expand navbar-light bg-white border bottom">
        <div class="container-fluid align-items-center d-flex">
          <a href="../homepage/homepage.html" class="logo me-2">
            <img src="../images/bookLET logo cropped.png" alt="bookLET" class="logo" />
          </a>

          <ul class="navbar-nav ms-3">
            <li class="nav-item help me-2">
              <a class="nav-link" href="../bookings/mybookings.php" style="color: #193764"
                >My Bookings</a
              >
            </li>
            <li class="nav-item log-in me-2">
              <a class="nav-link" style="color: white" href="../welcome/welcome.php"
                >Logout</a
              >
            </li>
          </ul>
        </div>
      </nav>

      <div class="container-fluid px-0">
        <div class="row g-0">
          <nav
            class="col-2 bg-white border-end py-4 sidebar-panel sidebar-width"
          >
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="../hotels/hotel.html">Hotels</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="../flights/flights.html">Flights</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="../cafes/cafes.html">Cafes</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="../adventures/adventures.html">Adventures</a>
              </li>
            </ul>
          </nav>

          <main class="col-10 mt-2 px-4 main-width">
            <div class="container">
              <nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a href="../homepage/homepage.html" class="text-decoration-none"
                      >Home</a
                    >
                  </li>
                  <li class="breadcrumb-item">
                    <a href="../flights/flights.html" class="text-decoration-none"
                      >Flights</a
                    >
                  </li>
                </ol>
              </nav>
            </div>

            <div class="container banner-wrapper">
              <img src="../images/flights.jpg" class="img-fluid flight-banner" />

              <div class="hero-caption">
                <h1 class="fw-bold text-white">Flights</h1>
                <p class="lead text-white">Book your next adventure</p>
              </div>
            </div>

            <form
              id="flightForm"
              class="container bg-white p-4 rounded-4 shadow-sm mt-4"
              onsubmit="return false;"
            >
              <div class="row g-3 align-items-end">
                <div class="col-md-3">
                  <label class="form-label small text-muted">From</label>
                  <select id="fromCity" class="form-select">
                    <option value="">Select airport</option>
                    <option value="Manila">MNL – Ninoy Aquino Intl</option>
                    <option value="Cebu">CEB – Mactan Intl</option>
                    <option value="Davao">DVO – Francisco Bangoy Intl</option>
                    <option value="Albay">LGP – Bicol Intl</option>
                    <option value="Baguio">BAG – Loakan</option>
                    <option value="Bacolod">BCD – Bacolod-Silay</option>
                    <option value="Iloilo">ILO – Iloilo Intl</option>
                    <option value="Dumaguete">DGT – Sibulan</option>
                    <option value="General Santos">GES – General Santos Intl</option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label small text-muted">To</label>
                  <select id="toCity" class="form-select">
                    <option value="">Select airport</option>
                    <option value="Manila">MNL – Ninoy Aquino Intl</option>
                    <option value="Cebu">CEB – Mactan Intl</option>
                    <option value="Davao">DVO – Francisco Bangoy Intl</option>
                    <option value="Albay">LGP – Bicol Intl</option>
                    <option value="Baguio">BAG – Loakan</option>
                    <option value="Bacolod">BCD – Bacolod-Silay</option>
                    <option value="Iloilo">ILO – Iloilo Intl</option>
                    <option value="Dumaguete">DGT – Sibulan</option>
                    <option value="General Santos">GES – General Santos Intl</option>
                  </select>
                </div>

                <div class="col-md-2">
                  <label class="form-label small text-muted">Departure</label>
                  <input type="date" id="departureDate" class="form-control" />
                </div>

                <div class="col-md-2">
                  <label class="form-label small text-muted"
                    >Return (optional)</label
                  >
                  <input type="date" id="returnDate" class="form-control" />
                </div>

                <div class="col-md-1">
                  <label class="form-label small text-muted">Adults</label>
                  <select id="adults" class="form-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                </div>

                <div class="col-md-1 d-grid">
                  <button class="btn btn-primary" onclick="searchFlights()">
                    Search
                  </button>
                </div>
              </div>
            </form>

            <div class="container mt-5">
              <div class="flight-results-wrapper">
                <div id="flightResults"></div>
              </div>
            </div>

            <br />
            <footer>
              <div class="copyright-footer">
                <p>
                  Copyright © 2025 bookLET. Ltd. All rights reserved <br />
                  Site Operator: bookLET.com. Ltd.
                </p>
              </div>
            </footer>
          </main>
        </div>
      </div>
    </div>

    <div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-4">
          <div class="modal-header">
            <h5 class="modal-title">Flight Summary</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <div class="modal-body">
            <div class="mb-4">
              <h6 class="mb-1">
                <strong>Airline:</strong> <span id="modalAirline"></span>
              </h6>
              <h6 class="mb-1">
                <strong>Duration:</strong> <span id="modalDuration"></span>
              </h6>
              <h6 class="mb-1">
                <strong>Price:</strong> ₱<span id="modalPrice"></span>
              </h6>
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-success" onclick="continueToPayment()">
              Continue to Payment
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const airportCodes = {
        Manila: "MNL",
        Cebu: "CEB",
        Davao: "DVO",
        Albay: "LGP",
        Baguio: "BAG",
        Bacolod: "BCD",
        Iloilo: "ILO",
        Dumaguete: "DGT",
        "General Santos": "GES"
      };

      function searchFlights() {
        const fromCity = document.getElementById("fromCity").value;
        const toCity = document.getElementById("toCity").value;
        const depart = document.getElementById("departureDate").value;
        const ret = document.getElementById("returnDate").value;
        const adults = document.getElementById("adults").value;

        if (!fromCity || !toCity || !depart) {
          alert("Please complete all required fields.");
          return;
        }

        if (fromCity === toCity) {
          alert("Departure and destination cannot be the same.");
          return;
        }

        let url =
          "searchflight.php" +
          "?from=" +
          airportCodes[fromCity] +
          "&to=" +
          airportCodes[toCity] +
          "&depart=" +
          depart +
          "&adults=" +
          adults;

        if (ret) {
          url += "&return=" + ret;
        }

        document.getElementById("flightResults").innerHTML =
          "<p>Searching flights...</p>";

        const xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);

        xhr.onload = function () {
          if (xhr.status === 200) {
            try {
              const data = JSON.parse(xhr.responseText);
              displayFlights(data);
            } catch (e) {
              document.getElementById("flightResults").innerHTML =
                "<p>Invalid response from server.</p>";
            }
          } else {
            document.getElementById("flightResults").innerHTML =
              "<p>Server error. Please try again.</p>";
          }
        };

        xhr.onerror = function () {
          document.getElementById("flightResults").innerHTML =
            "<p>Network error. Please check your connection.</p>";
        };

        xhr.send();
      }

      function formatDuration(iso) {
        if (!iso) return "N/A";

        const h = iso.match(/(\d+)H/);
        const m = iso.match(/(\d+)M/);

        let result = "";
        if (h) result += h[1] + "h ";
        if (m) result += m[1] + "m";

        return result.trim();
      }

      function displayFlights(flights) {
        const container = document.getElementById("flightResults");
        container.innerHTML = "";

        if (!Array.isArray(flights) || flights.length === 0) {
          container.innerHTML = "<p>No flights found.</p>";
          return;
        }

        flights.forEach((f) => {
          const card = document.createElement("div");
          card.className = "card mb-3 shadow-sm";

          card.innerHTML = `
      <div class="card-body">
        <h5 class="fw-bold">${f.airline}</h5>

        <p class="mb-1">
          Travel Duration: ${formatDuration(f.duration)}
        </p>

        <p class="mb-2">
          Price: <strong>₱${Number(f.price).toLocaleString()}</strong>
        </p>

        <style>
          .btn-success:active {
            background-color: #193764 !important;
            border-color: #193764 !important;
          }

          .btn-success:focus,
          .btn-success:active:focus {
            box-shadow: none;
          }
        </style>

        <button
          class="btn btn-success"
            onclick="openBookingModal(
              '${f.airline}',
              '${formatDuration(f.duration)}',
              '${Number(f.price).toLocaleString()}'
            )"
          >
          Book Now  
        </button>

      </div>
    `;

          container.appendChild(card);
        });
      }

      let selectedFlight = {};

      function openBookingModal(airline, duration, price) {
        selectedFlight = {
          airline: airline,
          duration: duration,
          price: price,
        };

        document.getElementById("modalAirline").innerText = airline;
        document.getElementById("modalDuration").innerText = duration;
        document.getElementById("modalPrice").innerText = price;

        const modal = new bootstrap.Modal(
          document.getElementById("bookingModal")
        );
        modal.show();
      }

      function continueToPayment() {
        const fromCity = document.getElementById("fromCity").value;
        const toCity = document.getElementById("toCity").value;
        const depart = document.getElementById("departureDate").value;
        const ret = document.getElementById("returnDate").value;
        const adults = document.getElementById("adults").value;

        const query =
          "?airline=" + encodeURIComponent(selectedFlight.airline) +
          "&duration=" + encodeURIComponent(selectedFlight.duration) +
          "&price=" + encodeURIComponent(selectedFlight.price) +
          "&from=" + encodeURIComponent(fromCity) +
          "&to=" + encodeURIComponent(toCity) +
          "&depart=" + encodeURIComponent(depart) +
          "&return=" + encodeURIComponent(ret) +
          "&adults=" + encodeURIComponent(adults);

        window.location.href = "../payments/payment.php" + query;
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
